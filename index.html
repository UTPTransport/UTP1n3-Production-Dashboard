<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Production Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
  color: white;
  font-family: Arial, sans-serif;
}
#header {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  background: #111;
  padding: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 10;
}
#appTitle { font-size: 18px; font-weight: bold; }
#siteSelect { font-size: 16px; padding: 4px; }
#dashboardFrame {
  position: absolute;
  top: 40px;
  left: 0;
  width: 100%;
  height: calc(100% - 40px);
  border: none;
}
#clockPage {
  position: absolute;
  top: 40px;
  left: 0;
  width: 100%;
  height: calc(100% - 40px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  color: #0f0;
  font-family: Arial, sans-serif;
}
#bigTime { font-size: 14rem; text-shadow: 0 0 50px #0f0; }
#bigDate { font-size: 6rem; margin-top: 20px; text-shadow: 0 0 30px #0f0; }
#weatherInfo { font-size: 4.5rem; margin-top: 30px; text-shadow: 0 0 20px #0f0, 0 0 40px #0f0, 0 0 60px #0f0; }
</style>
</head>
<body>

<div id="header">
  <div id="appTitle">Production Dashboard</div>
  <select id="siteSelect">
    <option value="UTP1">UTP 1</option>
    <option value="UTP3">UTP 3</option>
  </select>
</div>

<iframe id="dashboardFrame"></iframe>

<div id="clockPage" style="display:none;">
  <div id="bigTime"></div>
  <div id="bigDate"></div>
  <div id="weatherInfo">Loading weather...</div>
</div>

<script>
// ------------------ Slides ------------------
const commonSlidesSet1 = [
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.p",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g3473e6c60b9_0_1",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g33e220b68ce_0_14"
];

const commonSlidesSet2 = [
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g37b0bfcc0d1_0_2",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g37f10e0f009_1_13",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g37f10e0f009_1_17",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g37f10e0f009_1_21",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g347e42ef442_0_0",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g36e72d387a5_0_10",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g37b74c5db84_0_10",
  "https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g3772e3b3f81_0_11"
];

const siteSlides = {
  "UTP1": ["https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g3800dd7da6a_5_8"],
  "UTP3": ["https://docs.google.com/presentation/d/1pXeDdRBYbl4Spc7wYd6MY91ftwP9-yk7eu6nxim2q_o/embed?start=true&loop=true&delayms=15000#slide=id.g3800dd7da6a_5_18"]
};

// ------------------ Slideshow Logic ------------------
let pages = [];
let currentIndex = 0;
let timer;
const frame = document.getElementById("dashboardFrame");
const clockPage = document.getElementById("clockPage");
const siteSelect = document.getElementById("siteSelect");

function buildSlides(site) {
  pages = [
    ...commonSlidesSet1,
    "CLOCK",
    ...(siteSlides[site] || []),
    "CLOCK",
    ...commonSlidesSet2,
    "CLOCK"
  ];
}

function updateClock() {
  const now = new Date();
  document.getElementById("bigTime").innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
  document.getElementById("bigDate").innerText = now.toLocaleDateString([], {weekday:'long', year:'numeric', month:'long', day:'numeric'});
}

async function updateWeather() {
  const apiKey = "85158e35e52890edf18936f969fded80"; // replace with your API key
  const city = "Katunayaka";
  try {
    const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${apiKey}`);
    const data = await res.json();
    if(data.cod === 200){
      document.getElementById("weatherInfo").innerText = `${data.name}, ${data.sys.country} • ${Math.round(data.main.temp)}°C • ${data.weather[0].description}`;
    } else document.getElementById("weatherInfo").innerText = "Weather unavailable";
  } catch(err){ document.getElementById("weatherInfo").innerText = "Weather unavailable"; }
}

function showNextPage() {
  if (pages.length === 0) return;

  const item = pages[currentIndex % pages.length];

  if (item === "CLOCK") {
    frame.style.display = "none";
    clockPage.style.display = "flex";
    updateClock();
    updateWeather();
  } else {
    clockPage.style.display = "none";
    frame.style.display = "block";
    frame.src = item;
  }

  currentIndex = (currentIndex + 1) % pages.length;
}

function startSlideshow() {
  clearInterval(timer);
  currentIndex = 0;
  showNextPage();
  timer = setInterval(showNextPage, 15000);
}

// ------------------ Initialization ------------------
const urlParams = new URLSearchParams(window.location.search);
const initialSite = urlParams.get('site') || 'UTP1';
siteSelect.value = initialSite;
buildSlides(initialSite);
startSlideshow();

siteSelect.addEventListener("change", () => {
  const selectedSite = siteSelect.value;
  buildSlides(selectedSite);
  startSlideshow();
});

// Refresh clock/weather every second
setInterval(() => {
  if(clockPage.style.display === "flex") updateClock();
}, 1000);

// Refresh weather every 10 minutes
setInterval(updateWeather, 600000);
updateWeather();
</script>
</body>
</html>
